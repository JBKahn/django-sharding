machine:
  environment:
    DATABASE_URL: postgres://ubuntu:@127.0.0.1:5432/circle_test
    SHARD_001_DATABASE_URL: mysql://ubuntu:@127.0.0.1/shard_001
    SHARD_002_DATABASE_URL: postgres://ubuntu:@127.0.0.1:5432/shard_002
    REPLICA_001_DATABASE_URL: postgres://ubuntu:@127.0.0.1:5432/sharding_replica_001
    REPLICA_002_DATABASE_URL: postgres://ubuntu:@127.0.0.1:5432/sharding_replica_002
    TOX_PY27: '2.7.10'
    TOX_PY33: '3.3.6'
    TOX_PY34: '3.4.3'
    TOX_PY35: '3.5.0'

  python:
    version: 2.7.6

dependencies:
  override:
    - pyenv install -f 3.3.6
    - pyenv local $TOX_PY34 $TOX_PY33 $TOX_PY32 $TOX_PY27 $TOX_PY35

test:
  pre:
    - mysqladmin -uubuntu create shard_001
    - createdb -U ubuntu -w -p 5432 shard_002
    - createdb -U ubuntu -w -p 5432 sharding_replica_001
    - createdb -U ubuntu -w -p 5432 sharding_replica_002

  override:
    - tox
  post:
    - ./run_coverage.sh
