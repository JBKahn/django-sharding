machine:
  environment:
    DATABASE_URL: postgres://ubuntu:@127.0.0.1:5432/circle_test
    SHARD_001_DATABASE_URL: mysql://ubuntu:@127.0.0.1/shard_001
    SHARD_002_DATABASE_URL: postgres://ubuntu:@127.0.0.1:5432/shard_002
    REPLICA_001_DATABASE_URL: postgres://ubuntu:@127.0.0.1:5432/sharding_replica_001
    REPLICA_002_DATABASE_URL: postgres://ubuntu:@127.0.0.1:5432/sharding_replica_002
    TOX_PY27: '2.7.11'
    TOX_PY34: '3.4.3'
    TOX_PY35: '3.5.0'
  python:
    version: 2.7.11

dependencies:
  override:
    - pip install --upgrade pip
    - pip install --upgrade -r requirements-test.txt
    - pyenv local $TOX_PY35 $TOX_PY34 $TOX_PY27

test:
  pre:
    - mysqladmin -uubuntu create shard_001
    - createdb -U ubuntu -w -p 5432 shard_002
    - createdb -U ubuntu -w -p 5432 sharding_replica_001
    - createdb -U ubuntu -w -p 5432 sharding_replica_002
  override:
    - tox -v --recreate
  post:
    - ./run_coverage.sh
